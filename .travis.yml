sudo: required
dist: trusty
git:
  depth: 1
services:
  - docker
language: php
php:
  7.1
addons:
  apt:
    update: true
env:
  global:
    - DIR_TOOLS="/var/www/ece-tools"
  matrix:
    - TEST_SUITE=static-unit PHP=7.0 XDEBUG=true
    - TEST_SUITE=static-unit PHP=7.1 XDEBUG=true
    - TEST_SUITE=integration PHP=7.0
    - TEST_SUITE=integration PHP=7.1
cache:
  apt: true
  directories:
    - $HOME/.composer/cache
before_install:
  - echo "COMPOSER_MAGENTO_USERNAME=${REPO_USERNAME}" >> ./docker/composer.env
  - echo "COMPOSER_MAGENTO_PASSWORD=${REPO_PASSWORD}" >> ./docker/composer.env
  - if [ $XDEBUG == "true" ]; then echo "PHP_ENABLE_XDEBUG=true" >> ./docker/global.env; fi;
  - composer update -n
  - ./bin/ece-tools docker:build --test --php ${PHP}
install: docker-compose run cli bash -c "composer update -n -d ${DIR_TOOLS}"
before_script: docker-compose up -d --build
script: ./tests/travis/script.sh
after_failure: docker ps -s
