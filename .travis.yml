sudo: required
dist: trusty
git:
  depth: 1
services:
  - docker
language: generic
env:
  matrix:
#    - TEST_SUITE=static-unit PHP=7.0
#    - TEST_SUITE=static-unit PHP=7.1
    - TEST_SUITE=integration PHP=7.0
#    - TEST_SUITE=integration PHP=7.1
cache:
  apt: true
#  directories:
#    - $HOME/.composer/cache
before_install:
  - echo "COMPOSER_MAGENTO_USERNAME=${REPO_USERNAME}" >> ./docker/composer.env
  - echo "COMPOSER_MAGENTO_PASSWORD=${REPO_PASSWORD}" >> ./docker/composer.env
install:
  - docker-compose -f docker-compose-${PHP}.yml run cli bash -c "composer install -n -d /var/www/magento"
before_script:
  - sudo chown -R www-data:www-data .
  - docker-compose -f docker-compose-${PHP}.yml up -d --build
script: ./tests/travis/script.sh
after_failure: docker ps -s
